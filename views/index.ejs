<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('partials/header') %>
</head>
<body <%= typeof loadingState !== 'undefined' && loadingState === 'loading' ? 'data-loading="true"' : '' %>>
    <!-- Debug section (fixed position on the right) -->
    <div id="debugPanel" style="position: fixed; top: 20px; right: 20px; width: 280px; background: white; border: 1px solid #ddd; border-radius: 8px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); z-index: 1000; transition: width 0.2s ease;">
        <button id="debugPanelToggle" style="position: absolute; top: 15px; right: 15px; background: none; border: none; cursor: pointer; font-size: 1.2em; padding: 0; line-height: 1; z-index: 10;" title="Collapse panel">â–¼</button>
        <div id="debugPanelHeader" style="margin: 0 0 12px 0; border-bottom: 1px solid #ddd; padding-bottom: 8px; padding-right: 30px;">
            <span id="debugPanelTitle" style="font-size: 1em; font-weight: bold;">Debug Mode</span>
        </div>
        <div id="debugPanelContent">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 0.9em;">
                <input type="checkbox" id="debugToggle" />
                <span>Log to file</span>
            </label>
            <div id="debugStatus" style="margin-top: 10px; padding: 8px; background: #f0f0f0; border-radius: 4px; font-size: 0.85em; display: none; word-break: break-all; overflow-wrap: break-word;">
                <span id="debugStatusText"></span>
            </div>
        </div>
    </div>

    <div class="container">
        <h1>Discogs Wanted Sorter</h1>
        <p style="text-align: center;">View your Discogs collection sorted by most wanted records.</p>

        <%- include('partials/token-section') %>
        
        <div class="search-form">
            <form action="/search" method="POST">
                <input type="text" name="username" placeholder="Discogs Username" value="<%= username %>" required>
                <button type="submit">Search Collection</button>
            </form>
        </div>
        
        <% if (typeof error !== 'undefined' && error) { %>
            <div class="error">
                <%= error %>
            </div>
        <% } %>
        
        <!-- Progress indicators -->
        <%- include('partials/progress-indicators') %>
        
        <!-- Results container -->
        <%- include('partials/results-table') %>
        
        <div id="no-results" style="text-align: center; display: none;">
            <p>No records found for this user or collection is not public.</p>
        </div>
    </div>

    <!-- Include the client-side JavaScript -->
    <script src="/js/collection.js"></script>
</body>
</html>